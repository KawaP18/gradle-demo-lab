trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  GRADLE_USER_HOME: $(Pipeline.Workspace)/.gradle

steps:
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

- script: |
    # Compile Java source
    mkdir -p app/build/classes
    mkdir -p app/build/test-classes
    javac -d app/build/classes app/src/main/java/org/example/App.java
    
    # Compile and run tests
    javac -cp app/src/main/java -d app/build/test-classes app/src/test/java/org/example/SimpleTestRunner.java
    echo "Running Unit Tests:"
    java -cp "app/build/classes:app/build/test-classes" org.example.SimpleTestRunner
    
    # Run the application
    echo "\nRunning application:"
    java -cp app/build/classes org.example.App
    
    # Test reverse greeting feature
    echo "\nTesting reverse greeting feature:"
    java -cp app/build/classes -c "System.out.println(new org.example.App().getReverseGreeting());"
    
    # Show project info
    echo "\nProject Info:"
    echo "Project Name: gradle-demo"
    echo "Java Version: $(java -version 2>&1 | head -n 1)"
    echo "Build Time: $(date)"
  displayName: 'Build, Test and Run Java Application'